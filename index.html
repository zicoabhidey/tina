<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>My TinaCMS Site</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <header class="bg-white shadow-sm">
        <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center">
            <div>
                <h1 class="text-3xl font-bold text-gray-900">My Awesome Blog</h1>
                <p class="text-gray-500 mt-1">Powered by TinaCMS & GitHub Pages</p>
            </div>
            <!-- This link takes you to the editing interface -->
            <a href="/admin.html" class="inline-block bg-indigo-600 text-white font-bold py-2 px-4 rounded-lg shadow hover:bg-indigo-700 transition-colors">
                Admin Login
            </a>
        </div>
    </header>

    <main class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div id="posts-container" class="space-y-12">
            <!-- Posts will be loaded here by JavaScript -->
            <div class="text-center py-16">
                <p class="text-gray-500">Loading posts...</p>
            </div>
        </div>
    </main>

    <script type="module">
        // This script will fetch the content generated by TinaCMS
        import { createClient } from 'tinacms/dist/client';

        // Initialize the TinaCMS client
        const client = createClient({
            branch: 'main', // Or your default branch
            // These values will be automatically supplied by Tina Cloud in production
            clientId: '668d0a78-7159-4aa2-bc37-f28c47a9a6d8', 
            token: '8a93a61bf79876928ca5bd1f483cf232a8eaf97f',
        });

        async function loadPosts() {
            const postsContainer = document.getElementById('posts-container');
            try {
                // Fetch all documents from the "post" collection
                const postsResponse = await client.queries.postConnection();
                const posts = postsResponse.data.postConnection.edges.map(edge => edge.node);

                postsContainer.innerHTML = ''; // Clear loading message

                if (!posts || posts.length === 0) {
                    postsContainer.innerHTML = '<p class="text-center text-gray-500">No posts found. Add one in the admin panel!</p>';
                    return;
                }

                // Sort posts by date, newest first
                posts.sort((a, b) => new Date(b.date) - new Date(a.date));

                posts.forEach(post => {
                    const postElement = document.createElement('article');
                    postElement.className = 'bg-white p-6 sm:p-8 rounded-lg shadow-md';
                    const postDate = new Date(post.date).toLocaleDateString('en-US', {
                        year: 'numeric', month: 'long', day: 'numeric'
                    });

                    // TinaCMS provides the body as HTML if you use a rich-text field
                    const bodyHtml = post.body;

                    postElement.innerHTML = `
                        <h2 class="text-2xl sm:text-3xl font-bold text-gray-900">${post.title}</h2>
                        <p class="text-sm text-gray-500 mt-2">By ${post.author} on ${postDate}</p>
                        ${post.thumbnail ? `<img src="${post.thumbnail}" alt="${post.title}" class="my-4 rounded-lg shadow-sm w-full h-auto object-cover" style="max-height: 400px;">` : ''}
                        <div class="prose prose-lg max-w-none mt-6 text-gray-700">
                            ${bodyHtml}
                        </div>
                    `;
                    postsContainer.appendChild(postElement);
                });

            } catch (error) {
                console.error("Failed to load posts:", error);
                postsContainer.innerHTML = '<p class="text-center text-red-500">Could not load posts. Make sure your Tina Cloud Client ID and Token are set. See console for details.</p>';
            }
        }

        loadPosts();
    </script>
</body>
</html>
